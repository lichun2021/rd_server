package com.hawk.game.script;

import java.util.Map;

import org.hawk.os.HawkException;
import org.hawk.os.HawkOSOperator;
import org.hawk.script.HawkScript;
import org.hawk.script.HawkScriptHttpInfo;

import com.hawk.game.global.GlobalData;
import com.hawk.game.item.ConsumeItems;
import com.hawk.log.Action;
import com.hawk.game.player.Player;
import com.hawk.game.protocol.Const;
import com.hawk.game.protocol.Const.PlayerAttr;
import com.hawk.game.protocol.Script.ScriptError;

/**
 * 扣除钻石或资源
 * 
 * http://localhost:8080/script/exploit?playerName=l0001&gold=100&goldore=100&oil=100
 *
 * playerId: 玩家Id
 * playerName: 玩家名字
 * 
 * --------------------以下参数可选--------------------
 * gold: 水晶数100
 * goldore: 资源数100
 * oil: 资源数100
 * tombarthite: 资源数100
 * 
 * @author hawk
 *
 */
public class PlayerExploitHandler extends HawkScript {
	@Override
	public String action(Map<String, String> params, HawkScriptHttpInfo httpInfo) {
		try {
			Player player = GlobalData.getInstance().scriptMakesurePlayer(params);
			if (player == null) {
				return HawkScript.failedResponse(ScriptError.ACCOUNT_NOT_EXIST_VALUE, params.toString());
			}

			// 水晶
			String gold = params.get("gold");
			// 黄金
			String goldore = params.get("goldore");
			// 石油
			String oil = params.get("oil");
			// 合金
			String tombarthite = params.get("tombarthite");

			// 扣除
			ConsumeItems comsumeItems = ConsumeItems.valueOf();
			if (!HawkOSOperator.isEmptyString(gold)) {
				comsumeItems.addConsumeInfo(PlayerAttr.GOLD, Integer.parseInt(gold));
			}

			if (!HawkOSOperator.isEmptyString(goldore)) {
				comsumeItems.addConsumeInfo(Const.PlayerAttr.GOLDORE, Integer.parseInt(goldore));
			}

			if (!HawkOSOperator.isEmptyString(oil)) {
				comsumeItems.addConsumeInfo(Const.PlayerAttr.OIL, Integer.parseInt(oil));
			}

			if (!HawkOSOperator.isEmptyString(tombarthite)) {
				comsumeItems.addConsumeInfo(Const.PlayerAttr.TOMBARTHITE, Integer.parseInt(tombarthite));
			}

			if (comsumeItems.checkConsume(player)) {
				comsumeItems.consumeAndPush(player, Action.GM_EXPLOIT);
			}

			return HawkScript.successResponse(null);

		} catch (Exception e) {
			HawkException.catchException(e);
		}

		return HawkScript.failedResponse(ScriptError.EXCEPTION_VALUE, "");
	}
}
